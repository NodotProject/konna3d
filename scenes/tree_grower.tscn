[gd_scene load_steps=13 format=3 uid="uid://crgbartxaxrqx"]

[ext_resource type="Script" path="res://addons/nodot/interaction/StaticInteractBody3D.gd" id="1_374tg"]
[ext_resource type="PackedScene" uid="uid://bcj8oixv0ac7g" path="res://models/flora/tree_grow_patch.blend" id="1_ccdbw"]
[ext_resource type="Shader" path="res://addons/nodot/shaders/color_pulse.gdshader" id="3_uv683"]
[ext_resource type="PackedScene" uid="uid://vb2w3v1c24a1" path="res://models/flora/CommonTree_4.fbx" id="4_cjeqg"]
[ext_resource type="Script" path="res://scripts/Collectable3D.gd" id="5_hdeop"]

[sub_resource type="GDScript" id="GDScript_hydcb"]
resource_name = "tree_grow"
script/source = "extends Node3D

@export var mesh: MeshInstance3D

var pulsing := false
var pulse_material: ShaderMaterial

var planted := false
var grown := false

func _ready():
	mesh.material_overlay = mesh.material_overlay.duplicate()
	pulse_material = mesh.material_overlay
	pulse_material.set_shader_parameter(\"strength\", 0.00)
	get_parent().connect(\"interacted\", interact)
	
func start_pulse():
	if !pulsing:
		pulse_material.set_shader_parameter(\"strength\", 0.05)
		pulsing = true

func stop_pulse():
	pulse_material.set_shader_parameter(\"strength\", 0.00)
	pulsing = false

func interact():
	if planted:
		return
		
	if grown:
		cut_tree()
	else:
		plant_tree()
		
func plant_tree():
	planted = true
	var tween = get_tree().create_tween()
	tween.connect(\"finished\", tree_grown)
	%Tree.scale = Vector3.ZERO
	tween.parallel().tween_property(
		%Tree, \"scale\", Vector3(1.0, 1.0, 1.0), 20.0
	).set_trans(Tween.TRANS_LINEAR)
	tween.play()
	
func cut_tree():
	var inventory = Nodot.get_first_child_of_type(PlayerManager.node, CollectableInventory)
	inventory.add(\"Wood\", 1)
	# TODO: Show particle effect
	%Tree.scale = Vector3.ZERO
	grown = false
	
func tree_grown():
	grown = true
	planted = false
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_w0s7v"]
render_priority = 0
shader = ExtResource("3_uv683")
shader_parameter/pulse_speed = 5.0
shader_parameter/strength = 0.0
shader_parameter/color = Color(1, 1, 1, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_ycajl"]
resource_name = "Material.001"
cull_mode = 2
vertex_color_use_as_albedo = true
albedo_color = Color(0.19979, 0.100111, 0.0454465, 1)
roughness = 0.5

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_o4x16"]
resource_name = "Material.002"
cull_mode = 2
vertex_color_use_as_albedo = true
albedo_color = Color(0.233327, 0.0303856, 0.0245177, 1)
roughness = 0.5

[sub_resource type="ArrayMesh" id="ArrayMesh_s3d0q"]
_surfaces = [{
"aabb": AABB(-1.37869, -0.174799, -1.1901, 2.75738, 0.349598, 2.3802),
"format": 4097,
"index_count": 78,
"index_data": PackedByteArray(0, 0, 5, 0, 2, 0, 0, 0, 3, 0, 5, 0, 3, 0, 11, 0, 5, 0, 3, 0, 9, 0, 11, 0, 9, 0, 8, 0, 11, 0, 9, 0, 6, 0, 8, 0, 6, 0, 2, 0, 8, 0, 6, 0, 0, 0, 2, 0, 3, 0, 6, 0, 9, 0, 3, 0, 0, 0, 6, 0, 14, 0, 11, 0, 8, 0, 14, 0, 15, 0, 11, 0, 13, 0, 11, 0, 15, 0, 2, 0, 14, 0, 8, 0, 2, 0, 12, 0, 14, 0, 13, 0, 5, 0, 11, 0, 2, 0, 13, 0, 12, 0, 5, 0, 13, 0, 2, 0, 12, 0, 4, 0, 1, 0, 12, 0, 13, 0, 4, 0, 13, 0, 10, 0, 4, 0, 13, 0, 15, 0, 10, 0, 10, 0, 14, 0, 7, 0, 10, 0, 15, 0, 14, 0, 7, 0, 12, 0, 1, 0, 7, 0, 14, 0, 12, 0),
"name": "Material.001",
"primitive": 3,
"vertex_count": 16,
"vertex_data": PackedByteArray(227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 63, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 63, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 63, 227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 191, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 191, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 191, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 63, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 63, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 63, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 191, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 191, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 191, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 63, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 191, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 63, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 191)
}, {
"aabb": AABB(-1.10194, 0.0424657, -0.911581, 2.20389, 9.99868e-06, 1.82317),
"format": 4097,
"index_count": 6,
"index_data": PackedByteArray(1, 0, 2, 0, 0, 0, 1, 0, 3, 0, 2, 0),
"name": "Material.002",
"primitive": 3,
"vertex_count": 4,
"vertex_data": PackedByteArray(127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 63, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 191, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 63, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 191)
}]
blend_shape_mode = 0

[sub_resource type="ArrayMesh" id="ArrayMesh_o0ht8"]
resource_name = "tree_grow_patch-d11d0f845b02efd02051988adee36d58_Cube_001"
_surfaces = [{
"aabb": AABB(-1.37869, -0.174799, -1.1901, 2.75738, 0.349598, 2.3802),
"attribute_data": PackedByteArray(0, 0, 0, 62, 0, 0, 128, 62, 0, 0, 192, 62, 0, 0, 0, 0, 0, 0, 192, 62, 0, 0, 128, 63, 0, 0, 192, 62, 0, 0, 0, 0, 0, 0, 192, 62, 0, 0, 128, 63, 0, 0, 32, 63, 0, 0, 0, 0, 0, 0, 32, 63, 0, 0, 128, 63, 0, 0, 96, 63, 0, 0, 128, 62, 0, 0, 0, 62, 0, 0, 0, 63, 0, 0, 192, 62, 0, 0, 64, 63, 0, 0, 192, 62, 0, 0, 64, 63, 0, 0, 192, 62, 0, 0, 64, 63, 0, 0, 192, 62, 0, 0, 64, 63, 0, 0, 32, 63, 0, 0, 64, 63, 0, 0, 32, 63, 0, 0, 64, 63, 0, 0, 96, 63, 0, 0, 0, 63, 0, 0, 192, 62, 0, 0, 128, 62, 0, 0, 192, 62, 0, 0, 128, 62, 0, 0, 192, 62, 0, 0, 128, 62, 0, 0, 192, 62, 0, 0, 128, 62, 0, 0, 192, 62, 0, 0, 128, 62, 0, 0, 32, 63, 0, 0, 128, 62, 0, 0, 32, 63, 0, 0, 128, 62, 0, 0, 32, 63, 0, 0, 128, 62, 0, 0, 32, 63, 0, 0, 128, 62, 0, 0, 192, 62, 0, 0, 0, 63, 0, 0, 192, 62, 0, 0, 0, 63, 0, 0, 192, 62, 0, 0, 0, 63, 0, 0, 192, 62, 0, 0, 0, 63, 0, 0, 192, 62, 0, 0, 0, 63, 0, 0, 32, 63, 0, 0, 0, 63, 0, 0, 32, 63, 0, 0, 0, 63, 0, 0, 32, 63, 0, 0, 0, 63, 0, 0, 32, 63, 0, 0, 0, 63, 195, 217, 20, 63, 0, 0, 128, 63, 196, 217, 20, 63, 0, 0, 0, 0, 156, 147, 89, 63, 84, 250, 142, 62, 195, 217, 20, 63, 0, 0, 64, 63, 195, 217, 20, 63, 0, 0, 64, 63, 157, 147, 89, 63, 174, 5, 241, 62, 196, 217, 20, 63, 0, 0, 128, 62, 196, 217, 20, 63, 0, 0, 128, 62, 98, 108, 38, 63, 84, 250, 142, 62, 98, 108, 38, 63, 84, 250, 142, 62, 196, 217, 20, 63, 0, 0, 0, 63, 196, 217, 20, 63, 0, 0, 0, 63, 98, 108, 38, 63, 174, 5, 241, 62, 98, 108, 38, 63, 174, 5, 241, 62),
"format": 4119,
"index_count": 78,
"index_data": PackedByteArray(2, 0, 13, 0, 6, 0, 2, 0, 9, 0, 13, 0, 10, 0, 30, 0, 14, 0, 10, 0, 26, 0, 30, 0, 27, 0, 24, 0, 33, 0, 27, 0, 18, 0, 24, 0, 17, 0, 5, 0, 21, 0, 17, 0, 1, 0, 5, 0, 8, 0, 16, 0, 25, 0, 8, 0, 0, 0, 16, 0, 43, 0, 32, 0, 23, 0, 43, 0, 47, 0, 32, 0, 39, 0, 31, 0, 46, 0, 7, 0, 42, 0, 22, 0, 7, 0, 36, 0, 42, 0, 39, 0, 15, 0, 31, 0, 7, 0, 39, 0, 36, 0, 15, 0, 39, 0, 7, 0, 34, 0, 12, 0, 4, 0, 34, 0, 38, 0, 12, 0, 37, 0, 29, 0, 11, 0, 37, 0, 45, 0, 29, 0, 28, 0, 40, 0, 19, 0, 28, 0, 44, 0, 40, 0, 20, 0, 35, 0, 3, 0, 20, 0, 41, 0, 35, 0),
"material": SubResource("StandardMaterial3D_ycajl"),
"name": "Material.001",
"primitive": 3,
"vertex_count": 48,
"vertex_data": PackedByteArray(227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 63, 255, 127, 0, 0, 255, 255, 255, 191, 227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 63, 255, 127, 255, 127, 255, 127, 255, 255, 227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 63, 0, 0, 255, 127, 255, 127, 255, 255, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 63, 255, 255, 255, 255, 255, 127, 0, 0, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 63, 255, 255, 255, 127, 255, 127, 0, 0, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 63, 255, 127, 255, 127, 255, 127, 255, 255, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 63, 0, 0, 255, 127, 255, 127, 255, 255, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 63, 255, 127, 255, 255, 0, 0, 255, 191, 227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 191, 255, 127, 0, 0, 255, 255, 255, 191, 227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 191, 0, 0, 255, 127, 255, 127, 255, 255, 227, 120, 176, 191, 122, 254, 50, 190, 28, 85, 152, 191, 255, 255, 255, 255, 255, 127, 255, 255, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 191, 255, 127, 255, 127, 255, 127, 0, 0, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 191, 255, 255, 255, 127, 255, 127, 0, 0, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 191, 0, 0, 255, 127, 255, 127, 255, 255, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 191, 255, 255, 255, 255, 255, 127, 255, 255, 227, 120, 176, 191, 122, 254, 50, 62, 28, 85, 152, 191, 255, 127, 255, 255, 0, 0, 255, 191, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 63, 255, 127, 0, 0, 255, 255, 255, 191, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 63, 255, 127, 255, 127, 255, 127, 255, 255, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 63, 255, 255, 255, 127, 255, 127, 255, 255, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 63, 0, 0, 255, 127, 255, 127, 0, 0, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 63, 255, 255, 255, 255, 255, 127, 0, 0, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 63, 255, 127, 255, 127, 255, 127, 255, 255, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 63, 255, 127, 255, 255, 0, 0, 255, 191, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 63, 255, 127, 255, 255, 0, 0, 255, 191, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 63, 255, 255, 255, 127, 255, 127, 255, 255, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 191, 255, 127, 0, 0, 255, 255, 255, 191, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 191, 255, 255, 255, 255, 255, 127, 255, 255, 227, 120, 176, 63, 122, 254, 50, 190, 28, 85, 152, 191, 255, 255, 255, 127, 255, 127, 255, 255, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 191, 0, 0, 255, 127, 255, 127, 0, 0, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 191, 255, 127, 255, 127, 255, 127, 0, 0, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 191, 255, 255, 255, 255, 255, 127, 255, 255, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 191, 255, 127, 255, 255, 0, 0, 255, 191, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 191, 255, 127, 255, 255, 0, 0, 255, 191, 227, 120, 176, 63, 122, 254, 50, 62, 28, 85, 152, 191, 255, 255, 255, 127, 255, 127, 255, 255, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 63, 255, 255, 255, 127, 255, 127, 0, 0, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 63, 255, 255, 255, 255, 255, 127, 0, 0, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 63, 255, 127, 255, 255, 0, 0, 255, 191, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 191, 255, 127, 255, 127, 255, 127, 0, 0, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 191, 255, 255, 255, 127, 255, 127, 0, 0, 127, 12, 141, 191, 122, 254, 50, 62, 90, 93, 105, 191, 255, 127, 255, 255, 0, 0, 255, 191, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 63, 0, 0, 255, 127, 255, 127, 0, 0, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 63, 255, 255, 255, 255, 255, 127, 0, 0, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 63, 255, 127, 255, 255, 0, 0, 255, 191, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 63, 255, 127, 255, 255, 0, 0, 255, 191, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 191, 0, 0, 255, 127, 255, 127, 0, 0, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 191, 255, 127, 255, 127, 255, 127, 0, 0, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 191, 255, 127, 255, 255, 0, 0, 255, 191, 127, 12, 141, 63, 122, 254, 50, 62, 90, 93, 105, 191, 255, 127, 255, 255, 0, 0, 255, 191)
}, {
"aabb": AABB(-1.10194, 0.0424657, -0.911581, 2.20389, 9.99868e-06, 1.82317),
"attribute_data": PackedByteArray(0, 0, 0, 62, 0, 0, 128, 62, 0, 0, 0, 62, 0, 0, 0, 63, 0, 0, 192, 62, 0, 0, 128, 62, 0, 0, 192, 62, 0, 0, 0, 63),
"format": 4119,
"index_count": 6,
"index_data": PackedByteArray(1, 0, 2, 0, 0, 0, 1, 0, 3, 0, 2, 0),
"material": SubResource("StandardMaterial3D_o4x16"),
"name": "Material.002",
"primitive": 3,
"vertex_count": 4,
"vertex_data": PackedByteArray(127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 63, 255, 127, 255, 255, 255, 255, 255, 63, 127, 12, 141, 191, 135, 240, 45, 61, 90, 93, 105, 191, 255, 127, 255, 255, 255, 255, 255, 63, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 63, 255, 127, 255, 255, 255, 255, 255, 63, 127, 12, 141, 63, 135, 240, 45, 61, 90, 93, 105, 191, 255, 127, 255, 255, 255, 255, 255, 63)
}]
blend_shape_mode = 0
shadow_mesh = SubResource("ArrayMesh_s3d0q")

[sub_resource type="BoxShape3D" id="BoxShape3D_v4lhh"]
size = Vector3(0.661569, 0.0822413, 0.55808)

[node name="TreeGrower" type="StaticBody3D"]
script = ExtResource("1_374tg")

[node name="Model" parent="." node_paths=PackedStringArray("mesh") instance=ExtResource("1_ccdbw")]
script = SubResource("GDScript_hydcb")
mesh = NodePath("Cube")

[node name="Cube" parent="Model" index="0"]
material_overlay = SubResource("ShaderMaterial_w0s7v")
mesh = SubResource("ArrayMesh_o0ht8")

[node name="Tree" parent="." instance=ExtResource("4_cjeqg")]
unique_name_in_owner = true
transform = Transform3D(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_v4lhh")

[node name="WoodCollectable" type="Node3D" parent="."]
unique_name_in_owner = true
script = ExtResource("5_hdeop")
display_name = "Wood"

[editable path="Model"]
